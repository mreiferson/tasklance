{% extends "category.html" %}

{% block title %}Milestones - {{ block.super }}{% endblock %}

{% block content %}
<style type="text/css">
	#milestones {
		width: 668px;
	}
	
	.milestone {
		margin-bottom: 1em;
		background: #f0f0f0;
		padding: 10px;
	}
	
	.milestone .msMetaBanner {
		margin-bottom: 5px;
	}
	.milestone .msPercCompleted {
		text-align: center;
		font-size: 18px;
		font-weight: bold;
		font-family: Georgia;
		color: #fff;
		padding: 6px;
		background: #DE70AA;
		float: left;
	}
	.milestone .msDeadline {
		float: right;
		font-weight: bold;
		font-size: 12px;
		color: #666;
	}
	
	.milestone .msName {
		clear: both;
		font-weight: bold;
		font-size: 12px;
		color: #C62D7D;
	}
	
	.milestone .msDescription {
		clear: both;
		padding: 5px 0;
		color: #666;
	}
	
	.milestone .msDependenciesHeader {
		font-weight: bold;
		margin-bottom: 5px;
	}
	
	.milestone .msDependencies {
		margin-left: 25px;
		margin-bottom: 5px;
	}
	
	.msProject {
		clear: both;
	}
	
	.msProject .msProjectPercCompleted {
		font-weight: bold;
		color: #080;
		float: left;
		width: 75px;
		text-align: right;
		margin-right: 10px;
	}
	
	.msProject .msProjectName {
		font-weight: bold;
		float: left;
	}
</style>
<table cellspacing="0" id="overviewContainer">
	<tr>
		<td style="vertical-align: top;">
			<div id="milestones">
				{% for milestone in category.milestone_set.all %}
					<div id="milestone{{ milestone.id }}" class="milestone" rel="{{ milestone.id }}">
						<div class="msMetaBanner floatContainer">
							<div class="msPercCompleted">{{ milestone.perc_completed|floatformat:2 }}%</div>
							<div class="msDeadline">{{ milestone.days_remaining.days }} day{% ifnotequal milestone.days_remaining.days 1 %}s{% endifnotequal %} remaining ({{ milestone.deadline|date:"Y-m-d" }})</div>
						</div>
						<div class="msName">{{ milestone.name }}</div>
						<div class="msDescription">{{ milestone.description }}</div>
						<div class="msDependenciesHeader">Dependencies:</div>
						<div class="msDependencies">
							{% for project in milestone.project_set.all %}
							<div class="msProject floatContainer">
								<div class="msProjectPercCompleted">{{ project.perc_completed|floatformat:3 }}%</div>
								<div class="msProjectName">{{ project.name }}</div>
							</div>
							{% endfor %}
						</div>
						<select name="project_id">
							{% for project in category.project_set.all %}
							<option value="{{ project.id }}">{{ project.name }}</option>
							{% endfor %}
						</select>
						<a href="javascript:;" class="addProjectLink">Add Project As Dependency</a>
					</div>
				{% endfor %}
			</div>
		</td>
		<td style="vertical-align: top;">
			<div id="manage">
				<div class="addMilestoneContainer">
					<div class="addHeader">Add Milestone</div>
					{% include "addmilestone.html" %}
				</div>
			</div>
		</td>
	</tr>
</table>
<script type="text/javascript" language="javascript">
	$(document).ready(function() {
			$('.addProjectLink').click(function() {
					var parent = $(this).parents('.milestone');
					$.post('{% url pm_milestoneaddproject %}', { 'milestone_id': parent.attr('rel'), 'project_id': $(':select[name=project_id]', parent).val() }, 
						function(response) {
							$('.msDependencies', parent).append($('<div>').addClass('msProject').append(response.name));
						}, 'json');
				});
		});
</script>
{% endblock %}